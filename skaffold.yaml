apiVersion: skaffold/v4beta13
kind: Config
metadata:
  name: tripmonkey

profiles:

  - name: development
    activation:
      - command: dev

    manifests:
      rawYaml:
        - k8s/environments/0.development/deploy/*
    portForward:
      - resourceType: Service
        resourceName: ingress-nginx-controller
        namespace: default
        port: 80
        localPort: 80
      - resourceType: Service
        resourceName: debug-mongo-express-service
        namespace: default
        port: 8081
        localPort: 81

    build:
      local:
        push: false
      artifacts:
        # python services
        - image: admin-panel-image
          context: build/admin_panel
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app/

        - image: descriptor-service-image
          context: build/descriptor-service
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app/

        - image: keycloak-interface-image
          context: build/keycloak_interface
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app
              - src: '*.json'
                dest: /app/

        - image: recommendations-service-image
          context: build/recomendations-service
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app/

        - image: trends-service-image
          context: build/trends-service
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app/

        - image: workspace-backup-image
          context: build/workspace_backup
          docker:
            dockerfile: Dockerfile
          sync:
            manual:
              - src: '*.py'
                dest: /app
              - src: '*.json'
                dest: /app/

        # java services

        - image: notification-service-image
          context: build/notification-service
          docker:
            dockerfile: src/main/docker/Dockerfile.jvm
          sync:
            manual:
              - src: 'target/quarkus-app/lib/'
                dest: /deployments/lib/
              - src: 'target/quarkus-app/*.jar'
                dest: /deployments/
              - src: 'target/quarkus-app/app/'
                dest: /deployments/app/
              - src: 'target/quarkus-app/quarkus/'
                dest: /deployments/quarkus/

        - image: workspace-service-image
          context: build/workspace-service
          docker:
            dockerfile: src/main/docker/Dockerfile.jvm
          sync:
            manual:
              - src: 'target/quarkus-app/lib/'
                dest: /deployments/lib/
              - src: 'target/quarkus-app/*.jar'
                dest: /deployments/
              - src: 'target/quarkus-app/app/'
                dest: /deployments/app/
              - src: 'target/quarkus-app/quarkus/'
                dest: /deployments/quarkus/

        - image: database-service-image
          context: build/workspace-db-service
          docker:
            dockerfile: src/main/docker/Dockerfile.jvm
          sync:
            manual:
              - src: 'target/quarkus-app/lib/'
                dest: /deployments/lib/
              - src: 'target/quarkus-app/*.jar'
                dest: /deployments/
              - src: 'target/quarkus-app/app/'
                dest: /deployments/app/
              - src: 'target/quarkus-app/quarkus/'
                dest: /deployments/quarkus/

        - image: workspace-rest-image
          context: build/workspace-rest-service
          docker:
            dockerfile: src/main/docker/Dockerfile.jvm
          sync:
            manual:
              - src: 'target/quarkus-app/lib/'
                dest: /deployments/lib/
              - src: 'target/quarkus-app/*.jar'
                dest: /deployments/
              - src: 'target/quarkus-app/app/'
                dest: /deployments/app/
              - src: 'target/quarkus-app/quarkus/'
                dest: /deployments/quarkus/



  - name: test

  - name: prod

